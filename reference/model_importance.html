<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Quantifies the contribution of ensemble component models to ensemble prediction accuracy for each prediction task. — model_importance • modelimportance</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Quantifies the contribution of ensemble component models to ensemble prediction accuracy for each prediction task. — model_importance"><meta name="description" content="We measure each ensemble component model's contribution to the ensemble
prediction accuracy for each model task.
(See also model_importance_summary for a summary of importance
scores across multiple tasks.)
This function requires that one column represent the forecast date (or
a date from which each forecast originates or is made in reference to) and
that column be named one of forecast_date, origin_date, and
reference_date.
For each output_type, the corresponding scoring rule applied to calculate
the importance is as follows.

Output TypeScoring RuleDescription
meanrse_pointevaluate using the root squared error
medianae_pointevaluate using the absolute error
quantilewisevaluate using the weighted interval score
pmflog_scoreevaluate using the logarithm of the probability assigned to the true
outcome


"><meta property="og:description" content="We measure each ensemble component model's contribution to the ensemble
prediction accuracy for each model task.
(See also model_importance_summary for a summary of importance
scores across multiple tasks.)
This function requires that one column represent the forecast date (or
a date from which each forecast originates or is made in reference to) and
that column be named one of forecast_date, origin_date, and
reference_date.
For each output_type, the corresponding scoring rule applied to calculate
the importance is as follows.

Output TypeScoring RuleDescription
meanrse_pointevaluate using the root squared error
medianae_pointevaluate using the absolute error
quantilewisevaluate using the weighted interval score
pmflog_scoreevaluate using the logarithm of the probability assigned to the true
outcome


"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">modelimportance</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/get-started.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Quantifies the contribution of ensemble component models to ensemble prediction accuracy for each prediction task.</h1>

      <div class="d-none name"><code>model_importance.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>We measure each ensemble component model's contribution to the ensemble
prediction accuracy for each model task.
(See also <code><a href="model_importance_summary.html">model_importance_summary</a></code> for a summary of importance
scores across multiple tasks.)</p>
<p>This function requires that one column represent the forecast date (or
a date from which each forecast originates or is made in reference to) and
that column be named one of <code>forecast_date</code>, <code>origin_date</code>, and
<code>reference_date</code>.</p>
<p>For each <code>output_type</code>, the corresponding scoring rule applied to calculate
the importance is as follows.</p>
<table class="table table"><tr><td><strong>Output Type</strong></td><td><strong>Scoring Rule</strong></td><td><strong>Description</strong></td></tr><tr><td>mean</td><td>rse_point</td><td>evaluate using the root squared error</td></tr><tr><td>median</td><td>ae_point</td><td>evaluate using the absolute error</td></tr><tr><td>quantile</td><td>wis</td><td>evaluate using the weighted interval score</td></tr><tr><td>pmf</td><td>log_score</td><td>evaluate using the logarithm of the probability assigned to the true
outcome</td></tr></table></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">model_importance</span><span class="op">(</span></span>
<span>  <span class="va">forecast_data</span>,</span>
<span>  <span class="va">oracle_output_data</span>,</span>
<span>  ensemble_fun <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"simple_ensemble"</span>, <span class="st">"linear_pool"</span><span class="op">)</span>,</span>
<span>  importance_algorithm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lomo"</span>, <span class="st">"lasomo"</span><span class="op">)</span>,</span>
<span>  subset_wt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"equal"</span>, <span class="st">"perm_based"</span><span class="op">)</span>,</span>
<span>  min_log_score <span class="op">=</span> <span class="op">-</span><span class="fl">10</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-forecast-data">forecast_data<a class="anchor" aria-label="anchor" href="#arg-forecast-data"></a></dt>
<dd><p>A data.frame with the predictions that is or can be
coerced to a <code>model_out_tbl</code> format, which is the standard S3 class model
output format defined by the 'hubverse' convention
(https://docs.hubverse.io/en/latest/#). If it fails to be coerced to a
<code>model_out_tbl</code> format, an error message will be returned.
Only one <code>output_type</code> is allowed in the data.frame, and it must be one of
the following: <code>mean</code>, <code>median</code>, <code>quantile</code>, or <code>pmf</code>.</p></dd>


<dt id="arg-oracle-output-data">oracle_output_data<a class="anchor" aria-label="anchor" href="#arg-oracle-output-data"></a></dt>
<dd><p>Ground truth data for the variables that are used
to define modeling targets. This data must follow the oracle output format.
See 'Details'.</p></dd>


<dt id="arg-ensemble-fun">ensemble_fun<a class="anchor" aria-label="anchor" href="#arg-ensemble-fun"></a></dt>
<dd><p>A character string specifying a ensemble method, either
"simple_ensemble" or "linear_pool"; <code>c("simple_ensemble", "linear_pool")</code>.</p><ul><li><p>When <code>"simple_ensemble"</code> is specified, the ensemble is generated using the
optional <code>agg_fun</code> function in <code>...</code> (see 'Details').</p></li>
<li><p>When <code>"linear_pool"</code> is specified, ensemble model outputs are created as
a linear pool of component model outputs. This method supports only
an <code>output_type</code> of <code>mean</code>, <code>quantile</code>, or <code>pmf</code>.</p></li>
</ul></dd>


<dt id="arg-importance-algorithm">importance_algorithm<a class="anchor" aria-label="anchor" href="#arg-importance-algorithm"></a></dt>
<dd><p>A character string specifying algorithm for model
importance calculation; <code>c("lomo", "lasomo")</code>.
<code>"lomo"</code> stands for leave-one-model-out and
<code>"lasomo"</code> stands for leave all subsets of models out.
For <code>"lasomo"</code>, <code>'furrr'</code> and <code>'future'</code> packages need to be installed for
parallel execution.</p></dd>


<dt id="arg-subset-wt">subset_wt<a class="anchor" aria-label="anchor" href="#arg-subset-wt"></a></dt>
<dd><p>A character string specifying method for assigning weight
to subsets when using <code>lasomo</code> algorithm; <code>c("equal", "perm_based")</code>.</p><ul><li><p><code>"equal"</code> assigns equal weight to all subsets.</p></li>
<li><p><code>"perm_based"</code> assigns weight averaged over all possible permutations as in
the Shapley value.
Ignored if <code>lomo</code> method is used. Default is <code>"equal"</code>, if not specified.</p></li>
</ul></dd>


<dt id="arg-min-log-score">min_log_score<a class="anchor" aria-label="anchor" href="#arg-min-log-score"></a></dt>
<dd><p>A numeric value specifying a minimum threshold for log
scores for the <code>pmf</code> output. This threshold prevents issues with extremely
low probabilities assigned to the true outcome, which would otherwise lead to
undefined or negative infinite log scores.
Any probability lower than this threshold will be adjusted to this minimum
value. The default value is set to -10, following the CDC FluSight
thresholding convention. Users may choose a different value based on their
practical needs.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Optional arguments passed to <code>ensemble_fun</code> when it is specified
as <code>"simple_ensemble"</code>. See 'Details'.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>model_imp_tbl</code> S3 class object with columns <code>model_id</code>,
<code>reference_date</code>, <code>output_type</code>, and <code>importance</code>, along with any task ID
columns (e.g., <code>location</code>, <code>horizon</code>, and <code>target_end_date</code>) present in the
input <code>forecast_data</code>.
Note that <code>reference_date</code> is used as the name for the forecast date column,
regardless of its original name in the input <code>forecast_data</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code>oracle_output_data</code> is a data frame that contains the ground truth
values for the variables used to define modeling targets. It is referred to
as “oracle” because it is formatted as if an oracle made a perfect point
prediction equal to the truth. This data must follow the oracle output format
defined in the hubverse standard, which includes independent task ID columns
(e.g., <code>location</code>, <code>target_date</code>), the <code>output_type</code> column specifying the
output type of the predictions and an <code>oracle_value</code> column for the observed
values. As in the forecast data, if the <code>output_type</code> is either <code>"quantile"</code>
or <code>"pmf"</code>, the <code>output_type_id</code> column is often required to provide further
identifying information.</p>
<p>The <code>model_out_tbl</code> and <code>oracle_output_data</code> must have the same task ID
columns and <code>output_type</code>, including <code>output_type_id</code> if necessary, which are
used to match the predictions with the ground truth data.</p>
<p>Additional argument in <code>...</code> is <code>agg_fun</code>, which is a character string name
for a function specifying aggregation method of component model outputs.
Default is <code>mean</code>, indicating that equally weighted mean is calculated
across all component model outputs for each unique <code>output_type_id</code>.
This can be <code>median</code> or a custom function (e.g., geometric_mean. Details
can be found in
https://hubverse-org.github.io/hubEnsembles/articles/hubEnsembles.html).</p>
<p>This function uses the <code>furrr</code> and <code>future</code> for parallelization.
To enable parallel execution, please set a parallel backend, e.g., via
<code><a href="https://future.futureverse.org/reference/plan.html" class="external-link">future::plan()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="model_importance_summary.html">model_importance_summary</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">forecast_data</span> <span class="op">&lt;-</span> <span class="fu">hubExamples</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/hubExamples/man/forecast_data.html" class="external-link">forecast_outputs</a></span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">output_type</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"quantile"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="va">location</span> <span class="op">==</span> <span class="st">"25"</span>,</span></span>
<span class="r-in"><span>    <span class="va">horizon</span> <span class="op">==</span> <span class="fl">1</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">target_data</span> <span class="op">&lt;-</span> <span class="fu">hubExamples</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/hubExamples/man/forecast_data.html" class="external-link">forecast_target_ts</a></span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">target_end_date</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">forecast_data</span><span class="op">$</span><span class="va">target_end_date</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="va">location</span> <span class="op">==</span> <span class="st">"25"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="co"># Rename columns to match the oracle output format</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    oracle_value <span class="op">=</span> <span class="va">observation</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Example with the default arguments.</span></span></span>
<span class="r-in"><span><span class="fu">model_importance</span><span class="op">(</span></span></span>
<span class="r-in"><span>  forecast_data <span class="op">=</span> <span class="va">forecast_data</span>, oracle_output_data <span class="op">=</span> <span class="va">target_data</span>,</span></span>
<span class="r-in"><span>  ensemble_fun <span class="op">=</span> <span class="st">"simple_ensemble"</span>, importance_algorithm <span class="op">=</span> <span class="st">"lomo"</span>,</span></span>
<span class="r-in"><span>  subset_wt <span class="op">=</span> <span class="st">"equal"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Example with the additional argument in `...`.</span></span></span>
<span class="r-in"><span><span class="fu">model_importance</span><span class="op">(</span></span></span>
<span class="r-in"><span>  forecast_data <span class="op">=</span> <span class="va">forecast_data</span>, oracle_output_data <span class="op">=</span> <span class="va">target_data</span>,</span></span>
<span class="r-in"><span>  ensemble_fun <span class="op">=</span> <span class="st">"simple_ensemble"</span>, importance_algorithm <span class="op">=</span> <span class="st">"lomo"</span>,</span></span>
<span class="r-in"><span>  subset_wt <span class="op">=</span> <span class="st">"equal"</span>, agg_fun <span class="op">=</span> <span class="va">median</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Minsu Kim, Li Shandross, Nicholas Reich, Evan Ray.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

